type User @entity {
  id: ID!
  address: Bytes!
  balances: [Balance!] @derivedFrom(field: "user")
  transactions: [Transaction!] @derivedFrom(field: "user")
}

type Market @entity {
  id: ID!
  address: Bytes!
  decimals: Int!
  supplyIndex: BigInt!
  supplyUpdateBlockTimestamp: BigInt!
  borrowIndex: BigInt!
  borrowUpdateBlockTimestamp: BigInt!
  totalSupplyOnPool: BigInt!
  totalSupplyP2P: BigInt!
  totalBorrowOnPool: BigInt!
  totalBorrowP2P: BigInt!
  lastPoolSupplyIndex: BigInt!
  lastP2PSupplyIndex: BigInt!
  lastPoolBorrowIndex: BigInt!
  lastP2PBorrowIndex: BigInt!
}

type Balance @entity {
  id: ID!
  timestamp: BigInt!
  blockNumber: Int!
  market: Market!
  user: User!
  underlyingSupplyBalance: BigInt!
  underlyingBorrowBalance: BigInt!
  userSupplyIndex: BigInt!
  userBorrowIndex: BigInt!
  unclaimedMorpho: BigInt!
  borrowOnPool: BigInt!
  borrowP2P: BigInt!
  supplyOnPool: BigInt!
  supplyP2P: BigInt!
}

type Transaction @entity {
  id: ID!
  timestamp: BigInt!
  blockNumber: Int!
  market: Market!
  user: User!
  type: TransactionType!
  underlyingSupplyBalance: BigInt!
  underlyingBorrowBalance: BigInt!
}

type PositionUpdate @entity {
  id: ID!
  type: TransactionType!
  market: Market!
  user: User!
  balanceOnPool: BigInt!
  balanceInP2P: BigInt!
  eventTimestamp: Int!
}

enum TransactionType {
  Supply,
  Borrow,
  Withdraw,
  Repay
}
